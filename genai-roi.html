<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>GenAI Project ROI Calculator</title>
        <!-- Bootstrap CSS -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <!-- Chart.js -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <!-- MathJax for TeX Formulas -->
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <!-- Bootstrap Icons -->
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css"
        />
        <style>
            body {
                margin: 20px;
                background-color: #f8f9fa;
            }
            .slider-label {
                font-weight: bold;
            }
            .result-section p {
                font-size: 1.1em;
            }
            .nav-tabs .nav-link.active {
                background-color: #e9ecef;
            }
            .text-green {
                color: green;
            }
            .text-red {
                color: red;
            }
            .formula {
                background-color: #f1f1f1;
                padding: 10px;
                border-radius: 5px;
                margin-bottom: 10px;
            }
            .chart-container {
                position: relative;
                height: 400px;
            }
            .mb-4 {
                margin-bottom: 1.5rem;
            }
            .card {
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            }
            .accordion-button {
                font-weight: bold;
                font-size: 1.1em;
            }
            .accordion-button:not(.collapsed) {
                color: #fff;
                background-color: #007bff;
            }
            .accordion-button::after {
                filter: invert(1);
            }
            .accordion-header {
                background-color: #007bff;
            }
            .accordion-item {
                border: none;
                margin-bottom: 10px;
            }
            .input-group-text {
                background-color: #e9ecef;
            }
            .form-check-input:checked {
                background-color: #007bff;
                border-color: #007bff;
            }
            .form-check-label {
                margin-left: 10px;
            }
            h3,
            h5 {
                color: #007bff;
            }
            .btn-primary {
                background-color: #007bff;
                border: none;
            }
            .btn-primary:hover {
                background-color: #0056b3;
            }
        </style>
    </head>
    <body>
        <h1 class="text-center mb-4">GenAI Project ROI Calculator</h1>

        <!-- Tabs -->
        <ul class="nav nav-tabs" id="mainTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button
                    class="nav-link active"
                    id="calculator-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#calculator"
                    type="button"
                    role="tab"
                >
                    <i class="bi bi-calculator"></i> Calculator
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button
                    class="nav-link"
                    id="documentation-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#documentation"
                    type="button"
                    role="tab"
                >
                    <i class="bi bi-book"></i> Documentation
                </button>
            </li>
        </ul>

        <div class="tab-content" id="mainTabContent">
            <!-- Calculator Tab -->
            <div
                class="tab-pane fade show active"
                id="calculator"
                role="tabpanel"
            >
                <div class="row mt-4">
                    <!-- Input Section -->
                    <div class="col-md-4">
                        <div class="card mb-4">
                            <div class="card-body">
                                <h3>
                                    <i class="bi bi-sliders"></i> Input
                                    Parameters
                                </h3>

                                <!-- Build Cost Section -->
                                <h5 class="mt-3">
                                    <i class="bi bi-tools"></i> Build Costs
                                </h5>
                                <div
                                    class="form-check form-switch toggle-button"
                                >
                                    <input
                                        class="form-check-input"
                                        type="checkbox"
                                        id="buildCostToggle"
                                        onchange="toggleBuildCostInputs(); calculateROI();"
                                    />
                                    <label
                                        class="form-check-label"
                                        for="buildCostToggle"
                                        >Use Build Duration and Daily
                                        Cost</label
                                    >
                                </div>

                                <!-- Total Build Cost -->
                                <div id="totalBuildCostDiv">
                                    <label
                                        for="totalBuildCost"
                                        class="form-label"
                                        >Total Build Cost (€):</label
                                    >
                                    <div class="input-group mb-3">
                                        <span class="input-group-text">€</span>
                                        <input
                                            type="number"
                                            class="form-control"
                                            id="totalBuildCost"
                                            value="10000"
                                            min="0"
                                            step="100"
                                            onchange="calculateROI();"
                                        />
                                    </div>
                                </div>

                                <!-- Build Duration and Daily Cost -->
                                <div
                                    id="buildDurationDiv"
                                    style="display: none"
                                >
                                    <label for="buildDays" class="form-label"
                                        >Number of Build Days:</label
                                    >
                                    <input
                                        type="number"
                                        class="form-control mb-3"
                                        id="buildDays"
                                        value="20"
                                        min="0"
                                        step="1"
                                        onchange="calculateROI();"
                                    />
                                    <label for="costPerDay" class="form-label"
                                        >Cost per Day (€):</label
                                    >
                                    <div class="input-group mb-3">
                                        <span class="input-group-text">€</span>
                                        <input
                                            type="number"
                                            class="form-control"
                                            id="costPerDay"
                                            value="500"
                                            min="0"
                                            step="10"
                                            onchange="calculateROI();"
                                        />
                                    </div>
                                </div>

                                <!-- Time Saved per User per Week -->
                                <h5 class="mt-4">
                                    <i class="bi bi-clock"></i> Operational
                                    Parameters
                                </h5>
                                <div class="mb-3">
                                    <label
                                        for="timeSaved"
                                        class="form-label slider-label"
                                        >Time Saved per User per Week (hours):
                                        <span id="timeSavedValue"
                                            >1</span
                                        ></label
                                    >
                                    <input
                                        type="range"
                                        class="form-range"
                                        min="0"
                                        max="10"
                                        step="0.1"
                                        id="timeSaved"
                                        value="1"
                                        onchange="updateSlider('timeSaved'); calculateROI();"
                                    />
                                </div>
                                <!-- Monetary Value of Time Saved -->
                                <div class="mb-3">
                                    <label for="valuePerHour" class="form-label"
                                        >Monetary Value of Time Saved:</label
                                    >
                                    <div class="input-group">
                                        <span class="input-group-text">€</span>
                                        <input
                                            type="number"
                                            class="form-control"
                                            id="valuePerHour"
                                            value="100"
                                            min="0"
                                            step="1"
                                            onchange="calculateROI();"
                                        />
                                        <span class="input-group-text"
                                            >per hour</span
                                        >
                                    </div>
                                </div>
                                <!-- Queries per User per Day -->
                                <div class="mb-3">
                                    <label
                                        for="queriesPerDay"
                                        class="form-label slider-label"
                                        >Queries per User per Day:
                                        <span id="queriesPerDayValue"
                                            >10</span
                                        ></label
                                    >
                                    <input
                                        type="range"
                                        class="form-range"
                                        min="0"
                                        max="50"
                                        step="1"
                                        id="queriesPerDay"
                                        value="10"
                                        onchange="updateSlider('queriesPerDay'); calculateROI();"
                                    />
                                </div>
                                <!-- Number of Users -->
                                <div class="mb-3">
                                    <label
                                        for="numberOfUsers"
                                        class="form-label slider-label"
                                        >Number of Users:
                                        <span id="numberOfUsersValue"
                                            >50</span
                                        ></label
                                    >
                                    <input
                                        type="range"
                                        class="form-range"
                                        min="1"
                                        max="500"
                                        step="1"
                                        id="numberOfUsers"
                                        value="50"
                                        onchange="updateSlider('numberOfUsers'); calculateROI();"
                                    />
                                </div>
                                <!-- Months -->
                                <div class="mb-3">
                                    <label
                                        for="numberOfMonths"
                                        class="form-label slider-label"
                                        >Number of Months:
                                        <span id="numberOfMonthsValue"
                                            >12</span
                                        ></label
                                    >
                                    <input
                                        type="range"
                                        class="form-range"
                                        min="1"
                                        max="36"
                                        step="1"
                                        id="numberOfMonths"
                                        value="12"
                                        onchange="updateSlider('numberOfMonths'); calculateROI();"
                                    />
                                </div>
                                <!-- Working Days per Month -->
                                <div class="mb-3">
                                    <label for="workingDays" class="form-label"
                                        >Working Days per Month:</label
                                    >
                                    <input
                                        type="number"
                                        class="form-control"
                                        id="workingDays"
                                        value="22"
                                        min="1"
                                        max="31"
                                        step="1"
                                        onchange="calculateROI();"
                                    />
                                </div>
                                <!-- Weeks per Month -->
                                <div class="mb-3">
                                    <label
                                        for="weeksPerMonth"
                                        class="form-label"
                                        >Weeks per Month:</label
                                    >
                                    <input
                                        type="number"
                                        class="form-control"
                                        id="weeksPerMonth"
                                        value="4.3"
                                        min="1"
                                        max="5"
                                        step="0.1"
                                        onchange="calculateROI();"
                                    />
                                </div>
                                <!-- Cost per Query -->
                                <div class="mb-3">
                                    <label for="costPerQuery" class="form-label"
                                        >Cost per Query (€):</label
                                    >
                                    <div class="input-group">
                                        <span class="input-group-text">€</span>
                                        <input
                                            type="number"
                                            class="form-control"
                                            id="costPerQuery"
                                            value="0.00315"
                                            min="0"
                                            step="0.0001"
                                            onchange="calculateROI();"
                                        />
                                    </div>
                                </div>
                                <!-- Fixed Cost per Month -->
                                <div class="mb-3">
                                    <label for="fixedCost" class="form-label"
                                        >Fixed Cost per Month (€):</label
                                    >
                                    <div class="input-group">
                                        <span class="input-group-text">€</span>
                                        <input
                                            type="number"
                                            class="form-control"
                                            id="fixedCost"
                                            value="3000"
                                            min="0"
                                            step="100"
                                            onchange="calculateROI();"
                                        />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Result Section -->
                    <div class="col-md-8">
                        <!-- Accordion for Results -->
                        <div class="accordion mb-4" id="resultsAccordion">
                            <!-- Summary Section -->
                            <div class="accordion-item">
                                <h2
                                    class="accordion-header"
                                    id="headingSummary"
                                >
                                    <button
                                        class="accordion-button"
                                        type="button"
                                        data-bs-toggle="collapse"
                                        data-bs-target="#collapseSummary"
                                        aria-expanded="true"
                                        aria-controls="collapseSummary"
                                    >
                                        <i class="bi bi-bar-chart-fill"></i>
                                        Summary
                                    </button>
                                </h2>
                                <div
                                    id="collapseSummary"
                                    class="accordion-collapse collapse show"
                                    aria-labelledby="headingSummary"
                                    data-bs-parent="#resultsAccordion"
                                >
                                    <div class="accordion-body">
                                        <p>
                                            <strong
                                                >Total ROI over
                                                <span id="totalMonths"></span>
                                                Months:</strong
                                            >
                                            <span id="totalROISummary"></span>
                                        </p>
                                        <p>
                                            <strong
                                                >ROI per User over
                                                <span
                                                    id="totalMonthsUser"
                                                ></span
                                                Months:</strong
                                            >
                                            <span id="roiPerUserSummary"></span>
                                        </p>
                                        <p>
                                            <strong>Break-Even Point:</strong>
                                            <span id="breakEvenPoint"></span>
                                            Months
                                        </p>
                                        <p>
                                            <strong
                                                >Break-Even Benefit per
                                                User:</strong
                                            >
                                            <span
                                                id="benefitPerUserMinSummary"
                                            ></span>
                                        </p>
                                        <p>
                                            <strong
                                                >Minimal Number of Users to
                                                Break Even:</strong
                                            >
                                            <span
                                                id="numberOfUsersMinSummary"
                                            ></span>
                                        </p>
                                        <p>
                                            <strong
                                                >Solution Cost per
                                                Month:</strong
                                            >
                                            <span
                                                id="solutionCostPerMonth"
                                            ></span>
                                        </p>
                                        <p>
                                            <strong>Total Build Cost:</strong>
                                            <span
                                                id="totalBuildCostDisplay"
                                            ></span>
                                        </p>
                                        <p>
                                            <strong>Number of Users Minimum:</strong>
                                            <span id="numberOfUsersMin"></span>
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Active Users and Queries Needed to Cover Costs -->
                            <div class="accordion-item">
                                <h2
                                    class="accordion-header"
                                    id="headingActiveUsers"
                                >
                                    <button
                                        class="accordion-button collapsed"
                                        type="button"
                                        data-bs-toggle="collapse"
                                        data-bs-target="#collapseActiveUsers"
                                        aria-expanded="false"
                                        aria-controls="collapseActiveUsers"
                                    >
                                        <i class="bi bi-people-fill"></i> Active
                                        Users and Queries Needed
                                    </button>
                                </h2>
                                <div
                                    id="collapseActiveUsers"
                                    class="accordion-collapse collapse"
                                    aria-labelledby="headingActiveUsers"
                                    data-bs-parent="#resultsAccordion"
                                >
                                    <div class="accordion-body">
                                        <p>
                                            <strong
                                                >Users Needed per Month:</strong
                                            >
                                            <span
                                                id="usersNeededPerMonth"
                                            ></span>
                                        </p>
                                        <p>
                                            <strong
                                                >Queries Needed per
                                                Month:</strong
                                            >
                                            <span
                                                id="queriesNeededPerMonth"
                                            ></span>
                                        </p>
                                        <p>
                                            <strong
                                                >Users Needed per Week:</strong
                                            >
                                            <span
                                                id="usersNeededPerWeek"
                                            ></span>
                                        </p>
                                        <p>
                                            <strong
                                                >Queries Needed per
                                                Week:</strong
                                            >
                                            <span
                                                id="queriesNeededPerWeek"
                                            ></span>
                                        </p>
                                        <p>
                                            <strong
                                                >Users Needed per Day:</strong
                                            >
                                            <span id="usersNeededPerDay"></span>
                                        </p>
                                        <p>
                                            <strong
                                                >Queries Needed per Day:</strong
                                            >
                                            <span
                                                id="queriesNeededPerDay"
                                            ></span>
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Detailed Results -->
                            <div class="accordion-item">
                                <h2
                                    class="accordion-header"
                                    id="headingDetailedResults"
                                >
                                    <button
                                        class="accordion-button collapsed"
                                        type="button"
                                        data-bs-toggle="collapse"
                                        data-bs-target="#collapseDetailedResults"
                                        aria-expanded="false"
                                        aria-controls="collapseDetailedResults"
                                    >
                                        <i class="bi bi-list-check"></i>
                                        Detailed Results
                                    </button>
                                </h2>
                                <div
                                    id="collapseDetailedResults"
                                    class="accordion-collapse collapse"
                                    aria-labelledby="headingDetailedResults"
                                    data-bs-parent="#resultsAccordion"
                                >
                                    <div class="accordion-body">
                                        <p>
                                            <strong
                                                >Benefit per User
                                                (B<sub>u</sub>):</strong
                                            >
                                            <span id="benefitPerUser"></span>
                                        </p>
                                        <p>
                                            <strong
                                                >Queries per User per Month
                                                (Q<sub>u</sub>):</strong
                                            >
                                            <span id="queriesPerMonth"></span>
                                        </p>
                                        <p>
                                            <strong
                                                >Variable Cost per User
                                                (C<sub>var_u</sub>):</strong
                                            >
                                            <span
                                                id="variableCostPerUser"
                                            ></span>
                                        </p>
                                        <p>
                                            <strong
                                                >Fixed Cost per User
                                                (C<sub>fixed_u</sub>):</strong
                                            >
                                            <span id="fixedCostPerUser"></span>
                                        </p>
                                        <p>
                                            <strong
                                                >Total Cost per User
                                                (C<sub>u</sub>):</strong
                                            >
                                            <span id="totalCostPerUser"></span>
                                        </p>
                                        <p>
                                            <strong
                                                >ROI per User
                                                (ROI<sub>u</sub>):</strong
                                            >
                                            <span id="roiPerUser"></span>
                                        </p>
                                        <p>
                                            <strong
                                                >Total ROI per Month:</strong
                                            >
                                            <span id="totalROI"></span>
                                        </p>
                                        <p>
                                            <strong>Total Build Cost:</strong>
                                            <span
                                                id="totalBuildCostDetailed"
                                            ></span>
                                        </p>
                                        <p>
                                            <strong
                                                >Net ROI over
                                                <span
                                                    id="totalMonthsDetail"
                                                ></span>
                                                Months:</strong
                                            >
                                            <span id="netROI"></span>
                                        </p>
                                        <p>
                                            <strong>Break-Even Point:</strong>
                                            <span
                                                id="breakEvenPointDetailed"
                                            ></span>
                                            Months
                                        </p>
                                        <p>
                                            <strong>Benefit per User Minimum:</strong>
                                            <span id="benefitPerUserMin"></span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Charts -->
                        <div class="card mb-4">
                            <div class="card-body">
                                <h3>
                                    <i class="bi bi-graph-up"></i> ROI Over Time
                                </h3>
                                <div class="chart-container">
                                    <canvas id="roiChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Documentation Tab -->
            <div class="tab-pane fade" id="documentation" role="tabpanel">
                <div class="container mt-4">
                    <h2 class="mb-4"><i class="bi bi-book"></i> Documentation</h2>

                    <div class="card mb-4">
                        <div class="card-body">
                            <h3>Overview</h3>
                            <p>This calculator helps estimate the Return on Investment (ROI) for GenAI projects by considering various factors including build costs, operational parameters, and usage metrics.</p>
                        </div>
                    </div>

                    <div class="accordion" id="documentationAccordion">
                        <!-- Input Parameters Section -->
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#inputParams">
                                    Input Parameters
                                </button>
                            </h2>
                            <div id="inputParams" class="accordion-collapse collapse show" data-bs-parent="#documentationAccordion">
                                <div class="accordion-body">
                                    <h5>Build Costs</h5>
                                    <ul>
                                        <li><strong>Total Build Cost:</strong> One-time cost to build the solution</li>
                                        <li><strong>Build Duration and Daily Cost:</strong> Alternative way to calculate build cost</li>
                                    </ul>

                                    <h5>Operational Parameters</h5>
                                    <ul>
                                        <li><strong>Time Saved:</strong> Hours saved per user per week</li>
                                        <li><strong>Monetary Value:</strong> Value of each hour saved</li>
                                        <li><strong>Queries per Day:</strong> Average number of AI queries per user per day</li>
                                        <li><strong>Number of Users:</strong> Total users of the system</li>
                                        <li><strong>Time Period:</strong> Number of months for ROI calculation</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Calculations Section -->
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#calculations">
                                    Calculations
                                </button>
                            </h2>
                            <div id="calculations" class="accordion-collapse collapse" data-bs-parent="#documentationAccordion">
                                <div class="accordion-body">
                                    <h5>Key Formulas</h5>
                                    <div class="formula">
                                        <p>Monthly Benefit per User (B_u):</p>
                                        <p class="text-muted">B_u = Time Saved × Value per Hour × Weeks per Month</p>
                                    </div>

                                    <div class="formula">
                                        <p>Monthly Cost per User (C_u):</p>
                                        <p class="text-muted">C_u = (Queries per Day × Working Days × Cost per Query) + (Fixed Cost ÷ Number of Users)</p>
                                    </div>

                                    <div class="formula">
                                        <p>Net ROI:</p>
                                        <p class="text-muted">Net ROI = (Total Monthly ROI × Number of Months) - Build Cost</p>
                                    </div>

                                    <div class="formula">
                                        <p>Break-even Point:</p>
                                        <p class="text-muted">Break-even Months = Build Cost ÷ Monthly Profit</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Interpretation Section -->
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#interpretation">
                                    Interpretation
                                </button>
                            </h2>
                            <div id="interpretation" class="accordion-collapse collapse" data-bs-parent="#documentationAccordion">
                                <div class="accordion-body">
                                    <h5>Understanding Results</h5>
                                    <ul>
                                        <li><strong>Positive Net ROI:</strong> The project is profitable over the selected time period</li>
                                        <li><strong>Break-even Point:</strong> Number of months needed to recover the initial investment</li>
                                        <li><strong>Minimum Users:</strong> Minimum number of users needed for profitability</li>
                                    </ul>

                                    <h5>Chart Interpretation</h5>
                                    <ul>
                                        <li><strong>Net ROI Line:</strong> Cumulative return over time</li>
                                        <li><strong>Total Costs Line:</strong> Accumulated costs including build and operational costs</li>
                                        <li><strong>Total Benefits Line:</strong> Accumulated benefits from time savings</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bootstrap JS and Dependencies -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

        <!-- Chart.js -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        <script>
            // Initialize variables for chart
            var roiChart;

            function updateSlider(id) {
                var value = document.getElementById(id).value;
                document.getElementById(id + "Value").innerText = value;
                document
                    .getElementById(id + "Value")
                    .classList.add("animate__animated", "animate__fadeIn");
                setTimeout(function () {
                    document
                        .getElementById(id + "Value")
                        .classList.remove(
                            "animate__animated",
                            "animate__fadeIn",
                        );
                }, 500);
            }

            function formatCurrency(value) {
                if (value >= 0) {
                    return (
                        '<span class="text-green">€' +
                        value.toFixed(2) +
                        "</span>"
                    );
                } else {
                    return (
                        '<span class="text-red">€' +
                        value.toFixed(2) +
                        "</span>"
                    );
                }
            }

            function formatKEUR(value) {
                return (value / 1000).toFixed(2) + " k€";
            }

            function toggleBuildCostInputs() {
                var isChecked =
                    document.getElementById("buildCostToggle").checked;
                if (isChecked) {
                    document.getElementById("totalBuildCostDiv").style.display =
                        "none";
                    document.getElementById("buildDurationDiv").style.display =
                        "block";
                } else {
                    document.getElementById("totalBuildCostDiv").style.display =
                        "block";
                    document.getElementById("buildDurationDiv").style.display =
                        "none";
                }
            }

            function calculateROI() {
                // Input values
                var T_s = parseFloat(document.getElementById("timeSaved").value);
                var R = parseFloat(document.getElementById("valuePerHour").value);
                var Q_d = parseFloat(document.getElementById("queriesPerDay").value);
                var N_u = parseInt(document.getElementById("numberOfUsers").value);
                var D_m = parseInt(document.getElementById("workingDays").value);
                var W_m = parseFloat(document.getElementById("weeksPerMonth").value);
                var C_query = parseFloat(document.getElementById("costPerQuery").value);
                var fixedCost = parseFloat(document.getElementById("fixedCost").value);
                var numMonths = parseInt(document.getElementById("numberOfMonths").value);

                // Add error checking for inputs
                if (isNaN(T_s) || isNaN(R) || isNaN(Q_d) || isNaN(N_u) || isNaN(D_m) ||
                    isNaN(W_m) || isNaN(C_query) || isNaN(fixedCost) || isNaN(numMonths)) {
                    console.error("Invalid input values");
                    return;
                }

                // Calculate build cost
                var C_build = document.getElementById("buildCostToggle").checked ?
                    parseFloat(document.getElementById("buildDays").value) * parseFloat(document.getElementById("costPerDay").value) :
                    parseFloat(document.getElementById("totalBuildCost").value);

                // Calculate ROI components
                var B_u = T_s * R * W_m; // Benefit per user per month
                var Q_u = Q_d * D_m; // Queries per user per month
                var C_var_u = Q_u * C_query; // Variable cost per user per month
                var C_fixed_u = fixedCost / N_u; // Fixed cost per user per month
                var C_u = C_var_u + C_fixed_u; // Total cost per user per month
                var ROI_u = B_u - C_u; // ROI per user per month
                var Total_ROI = ROI_u * N_u; // Total ROI per month
                var Solution_Cost = fixedCost + (C_var_u * N_u); // Total solution cost per month
                var Net_ROI = (Total_ROI * numMonths) - C_build; // Net ROI over the period

                // Calculate break-even point
                var Monthly_Profit = Total_ROI;
                var BreakEven_Months = Monthly_Profit > 0 ? C_build / Monthly_Profit : Infinity;

                // Calculate minimum values needed
                var B_u_min = C_u; // Minimum benefit per user needed to break even
                var N_u_min = Math.ceil(fixedCost / (B_u - C_var_u)); // Minimum number of users needed

                // Calculate users and queries needed
                var Users_Month = Math.ceil(Solution_Cost / (B_u - C_var_u));
                var Queries_Month = Users_Month * Q_u;
                var Users_Week = Math.ceil(Users_Month / W_m);
                var Queries_Week = Math.ceil(Queries_Month / W_m);
                var Users_Day = Math.ceil(Users_Month / D_m);
                var Queries_Day = Math.ceil(Queries_Month / D_m);

                try {
                    // Update all DOM elements with error checking
                    const updateElement = (id, value, formatter = (x) => x) => {
                        const element = document.getElementById(id);
                        if (element) {
                            element.innerHTML = formatter(value);
                        } else {
                            console.warn(`Element with id '${id}' not found`);
                        }
                    };

                    // Update calculations with proper error handling
                    updateElement("benefitPerUser", B_u, formatCurrency);
                    updateElement("queriesPerMonth", Q_u, (x) => x.toFixed(0));
                    updateElement("variableCostPerUser", C_var_u, formatCurrency);
                    updateElement("fixedCostPerUser", C_fixed_u, formatCurrency);
                    updateElement("totalCostPerUser", C_u, formatCurrency);
                    updateElement("roiPerUser", ROI_u, formatCurrency);
                    updateElement("totalROI", Total_ROI, formatCurrency);
                    updateElement("benefitPerUserMin", B_u_min, formatCurrency);
                    updateElement("netROI", Net_ROI, formatCurrency);
                    updateElement("breakEvenPointDetailed",
                        typeof BreakEven_Months === "number" ? BreakEven_Months.toFixed(2) : "N/A");
                    updateElement("totalBuildCostDetailed", C_build, formatCurrency);
                    updateElement("totalMonthsDetail", numMonths);

                    // Update summary section
                    updateElement("totalROISummary", Net_ROI, formatCurrency);
                    updateElement("roiPerUserSummary", ROI_u * numMonths, formatCurrency);
                    updateElement("benefitPerUserMinSummary", B_u_min, formatCurrency);
                    updateElement("solutionCostPerMonth", Solution_Cost, formatCurrency);
                    updateElement("totalBuildCostDisplay", C_build, formatCurrency);
                    updateElement("totalMonths", numMonths);
                    updateElement("totalMonthsUser", numMonths);
                    updateElement("breakEvenPoint",
                        typeof BreakEven_Months === "number" ? BreakEven_Months.toFixed(2) : "N/A");
                    updateElement("numberOfUsersMin", N_u_min);
                    updateElement("numberOfUsersMinSummary", N_u_min);

                    // Update users and queries needed
                    updateElement("usersNeededPerMonth", Users_Month);
                    updateElement("queriesNeededPerMonth", Queries_Month);
                    updateElement("usersNeededPerWeek", Users_Week);
                    updateElement("queriesNeededPerWeek", Queries_Week);
                    updateElement("usersNeededPerDay", Users_Day);
                    updateElement("queriesNeededPerDay", Queries_Day);

                    // Update chart
                    updateChart(numMonths, Total_ROI, Solution_Cost, N_u, ROI_u, C_build);

                } catch (error) {
                    console.error("Error updating DOM:", error);
                }
            }

            function updateChart(numMonths, Total_ROI, Solution_Cost, N_u, ROI_u, C_build) {
                try {
                    const canvas = document.getElementById("roiChart");
                    if (!canvas) {
                        console.error("Chart canvas element not found");
                        return;
                    }

                    // Destroy existing chart if it exists
                    if (roiChart) {
                        roiChart.destroy();
                    }

                    // Generate data points for the chart
                    const labels = Array.from({length: numMonths}, (_, i) => `Month ${i + 1}`);
                    const cumulativeROI = Array.from({length: numMonths}, (_, i) =>
                        (Total_ROI * (i + 1)) - C_build);
                    const cumulativeCosts = Array.from({length: numMonths}, (_, i) =>
                        Solution_Cost * (i + 1) + C_build);
                    const cumulativeBenefits = Array.from({length: numMonths}, (_, i) =>
                        (Total_ROI + Solution_Cost) * (i + 1));

                    // Create new chart
                    roiChart = new Chart(canvas, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [
                                {
                                    label: 'Net ROI',
                                    data: cumulativeROI,
                                    borderColor: 'rgb(75, 192, 192)',
                                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                    fill: true,
                                    tension: 0.1
                                },
                                {
                                    label: 'Total Costs',
                                    data: cumulativeCosts,
                                    borderColor: 'rgb(255, 99, 132)',
                                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                                    fill: true,
                                    tension: 0.1
                                },
                                {
                                    label: 'Total Benefits',
                                    data: cumulativeBenefits,
                                    borderColor: 'rgb(54, 162, 235)',
                                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                                    fill: true,
                                    tension: 0.1
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Cumulative ROI, Costs, and Benefits Over Time'
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            return context.dataset.label + ': €' +
                                                context.raw.toLocaleString('en-US', {
                                                    minimumFractionDigits: 2,
                                                    maximumFractionDigits: 2
                                                });
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return '€' + value.toLocaleString('en-US', {
                                                minimumFractionDigits: 0,
                                                maximumFractionDigits: 0
                                            });
                                        }
                                    }
                                }
                            }
                        }
                    });
                } catch (error) {
                    console.error("Error updating chart:", error);
                }
            }

            function getGradient(ctx, color) {
                var gradient = ctx.createLinearGradient(0, 0, 0, 400);
                if (color === "green") {
                    gradient.addColorStop(0, "rgba(0, 128, 0, 0.5)");
                    gradient.addColorStop(1, "rgba(0, 128, 0, 0)");
                } else if (color === "red") {
                    gradient.addColorStop(0, "rgba(255, 0, 0, 0.5)");
                    gradient.addColorStop(1, "rgba(255, 0, 0, 0)");
                } else if (color === "blue") {
                    gradient.addColorStop(0, "rgba(0, 0, 255, 0.5)");
                    gradient.addColorStop(1, "rgba(0, 0, 255, 0)");
                }
                return gradient;
            }

            // Ensure the DOM is fully loaded before running calculations
            document.addEventListener("DOMContentLoaded", function () {
                // Initial calculation
                calculateROI();

                // Initialize Bootstrap Tabs
                var triggerTabList = [].slice.call(
                    document.querySelectorAll("#mainTab button"),
                );
                triggerTabList.forEach(function (triggerEl) {
                    var tabTrigger = new bootstrap.Tab(triggerEl);
                    triggerEl.addEventListener("click", function (event) {
                        event.preventDefault();
                        tabTrigger.show();
                    });
                });
            });
        </script>
    </body>
</html>
