<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROI Calculator</title>

    <!-- External Dependencies -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Application CSS -->
    <style>
        .metric-card {
            background-color: #ffffff;
            border: 1px solid rgba(0,0,0,0.1);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }
        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
            margin: 20px 0;
        }
        .badge {
            font-size: 0.9rem;
            padding: 0.5em 0.8em;
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <h1 class="mb-4">ROI Calculator</h1>

        <!-- Error Container -->
        <div id="errorContainer"></div>

        <!-- Input Form -->
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title mb-4">Input Parameters</h5>
                <form id="roiForm">
                    <!-- User Base -->
                    <div class="mb-4">
                        <h6 class="mb-3">User Base</h6>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="numberOfUsers" class="form-label">Number of Users</label>
                                <input type="number" class="form-control" id="numberOfUsers" min="0" value="0">
                            </div>
                            <div class="col-md-6">
                                <label for="workingDays" class="form-label">Working Days per Month</label>
                                <input type="number" class="form-control" id="workingDays" min="1" max="31" value="20">
                            </div>
                        </div>
                    </div>

                    <!-- Time & Value -->
                    <div class="mb-4">
                        <h6 class="mb-3">Time & Value</h6>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label for="timeSaved" class="form-label">Time Saved (hours/day)</label>
                                <input type="number" class="form-control" id="timeSaved" min="0" step="0.1" value="0">
                            </div>
                            <div class="col-md-4">
                                <label for="valuePerHour" class="form-label">Value per Hour (€)</label>
                                <input type="number" class="form-control" id="valuePerHour" min="0" value="0">
                            </div>
                            <div class="col-md-4">
                                <label for="queriesPerDay" class="form-label">Queries per Day</label>
                                <input type="number" class="form-control" id="queriesPerDay" min="0" value="0">
                            </div>
                        </div>
                    </div>

                    <!-- Costs -->
                    <div class="mb-4">
                        <h6 class="mb-3">Costs</h6>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="costPerQuery" class="form-label">Cost per Query (€)</label>
                                <input type="number" class="form-control" id="costPerQuery" min="0" step="0.01" value="0">
                            </div>
                            <div class="col-md-6">
                                <label for="fixedCost" class="form-label">Fixed Monthly Cost (€)</label>
                                <input type="number" class="form-control" id="fixedCost" min="0" value="0">
                            </div>
                        </div>
                    </div>

                    <!-- Build Cost -->
                    <div class="mb-4">
                        <h6 class="mb-3">Build Cost</h6>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="buildCostToggle">
                            <label class="form-check-label" for="buildCostToggle">
                                Calculate build cost from days and rate
                            </label>
                        </div>
                        <div id="calculatedBuildCost" class="row g-3" style="display: none;">
                            <div class="col-md-6">
                                <label for="buildDays" class="form-label">Build Days</label>
                                <input type="number" class="form-control" id="buildDays" min="0" value="0">
                            </div>
                            <div class="col-md-6">
                                <label for="costPerDay" class="form-label">Cost per Day (€)</label>
                                <input type="number" class="form-control" id="costPerDay" min="0" value="0">
                            </div>
                        </div>
                        <div id="customBuildCost" class="row g-3">
                            <div class="col-12">
                                <label for="totalBuildCost" class="form-label">Total Build Cost (€)</label>
                                <input type="number" class="form-control" id="totalBuildCost" min="0" value="0">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Results Section -->
        <div class="accordion" id="resultsAccordion">
            <!-- ROI Summary -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingSummary">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseSummary" aria-expanded="true" aria-controls="collapseSummary">
                        <i class="bi bi-graph-up"></i> ROI Summary
                    </button>
                </h2>
                <div id="collapseSummary" class="accordion-collapse collapse show" aria-labelledby="headingSummary"
                    data-bs-parent="#resultsAccordion">
                    <div class="accordion-body">
                        <div class="row g-4">
                            <div class="col-md-6">
                                <div class="metric-card h-100 p-4">
                                    <h6 class="text-primary mb-3">Monthly ROI</h6>
                                    <div class="h3" id="totalROISummary">€0</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="metric-card h-100 p-4">
                                    <h6 class="text-primary mb-3">Monthly Value Generated</h6>
                                    <div class="h3" id="monthlyValueGenerated">€0</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Detailed Results -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingDetails">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseDetails" aria-expanded="false" aria-controls="collapseDetails">
                        <i class="bi bi-list-check"></i> Detailed Results
                    </button>
                </h2>
                <div id="collapseDetails" class="accordion-collapse collapse" aria-labelledby="headingDetails"
                    data-bs-parent="#resultsAccordion">
                    <div class="accordion-body">
                        <div class="row g-4">
                            <div class="col-md-6">
                                <div class="metric-card h-100 p-4">
                                    <h6 class="text-primary mb-3">Benefits Analysis</h6>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Benefit per User:</span>
                                        <span id="benefitPerUser" class="badge bg-primary">€0</span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Total Monthly Value:</span>
                                        <span id="totalMonthlyValue" class="badge bg-success">€0</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="metric-card h-100 p-4">
                                    <h6 class="text-primary mb-3">Cost Analysis</h6>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Monthly Cost per User:</span>
                                        <span id="totalCostPerUser" class="badge bg-danger">€0</span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Net ROI (12 months):</span>
                                        <span id="netROI" class="badge bg-success">€0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingCharts">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseCharts" aria-expanded="false" aria-controls="collapseCharts">
                        <i class="bi bi-graph-up"></i> ROI Charts
                    </button>
                </h2>
                <div id="collapseCharts" class="accordion-collapse collapse" aria-labelledby="headingCharts"
                    data-bs-parent="#resultsAccordion">
                    <div class="accordion-body">
                        <div class="chart-container">
                            <canvas id="roiChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- External Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Application JavaScript -->
    <script>
        // Global chart variable
        let roiChart;

        function calculateROI() {
            try {
                // Get input values
                const inputs = {
                    numberOfUsers: parseFloat(document.getElementById("numberOfUsers").value) || 0,
                    timeSaved: parseFloat(document.getElementById("timeSaved").value) || 0,
                    valuePerHour: parseFloat(document.getElementById("valuePerHour").value) || 0,
                    queriesPerDay: parseFloat(document.getElementById("queriesPerDay").value) || 0,
                    workingDays: parseFloat(document.getElementById("workingDays").value) || 0,
                    costPerQuery: parseFloat(document.getElementById("costPerQuery").value) || 0,
                    fixedCost: parseFloat(document.getElementById("fixedCost").value) || 0,
                    buildCost: document.getElementById("buildCostToggle").checked ?
                        parseFloat(document.getElementById("buildDays").value) * parseFloat(document.getElementById("costPerDay").value) :
                        parseFloat(document.getElementById("totalBuildCost").value) || 0
                };

                // Calculate metrics
                const metrics = {
                    monthlyQueries: inputs.queriesPerDay * inputs.workingDays,
                    monthlyBenefit: inputs.timeSaved * inputs.valuePerHour * inputs.workingDays,
                    monthlyVariableCost: (inputs.queriesPerDay * inputs.workingDays) * inputs.costPerQuery,
                    monthlyFixedCostPerUser: inputs.fixedCost / (inputs.numberOfUsers || 1),
                    totalMonthlyCost: 0,
                    monthlyROIPerUser: 0,
                    totalMonthlyROI: 0,
                    buildCost: inputs.buildCost
                };

                // Calculate derived metrics
                metrics.totalMonthlyCost = metrics.monthlyVariableCost + metrics.monthlyFixedCostPerUser;
                metrics.monthlyROIPerUser = metrics.monthlyBenefit - metrics.totalMonthlyCost;
                metrics.totalMonthlyROI = (metrics.monthlyROIPerUser * inputs.numberOfUsers) - inputs.fixedCost;

                // Update UI
                updateROISummary(metrics, inputs);
                updateDetailedResults(metrics, inputs);
                updateROICharts(metrics, inputs);

            } catch (error) {
                console.error("Error in calculateROI:", error);
            }
        }

        function updateROISummary(metrics, inputs) {
            document.getElementById("totalROISummary").textContent = `€${metrics.totalMonthlyROI.toFixed(2)}`;
            document.getElementById("monthlyValueGenerated").textContent =
                `€${(metrics.monthlyBenefit * inputs.numberOfUsers).toFixed(2)}`;
        }

        function updateDetailedResults(metrics, inputs) {
            document.getElementById("benefitPerUser").textContent = `€${metrics.monthlyBenefit.toFixed(2)}`;
            document.getElementById("totalMonthlyValue").textContent =
                `€${(metrics.monthlyBenefit * inputs.numberOfUsers).toFixed(2)}`;
            document.getElementById("totalCostPerUser").textContent = `€${metrics.totalMonthlyCost.toFixed(2)}`;
            document.getElementById("netROI").textContent =
                `€${(metrics.totalMonthlyROI * 12 - metrics.buildCost).toFixed(2)}`;
        }

        function updateROICharts(metrics, inputs) {
            const months = 12;
            const labels = Array.from({length: months + 1}, (_, i) => `Month ${i}`);

            const roiData = labels.map((_, i) => {
                if (i === 0) return -metrics.buildCost;
                return -metrics.buildCost + (metrics.totalMonthlyROI * i);
            });

            const benefitData = labels.map((_, i) => {
                if (i === 0) return 0;
                return (metrics.monthlyBenefit * inputs.numberOfUsers) * i;
            });

            const costData = labels.map((_, i) => {
                if (i === 0) return metrics.buildCost;
                return metrics.buildCost + ((metrics.totalMonthlyCost * inputs.numberOfUsers + inputs.fixedCost) * i);
            });

            if (!roiChart) {
                const ctx = document.getElementById('roiChart').getContext('2d');
                roiChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Net ROI',
                                data: roiData,
                                borderColor: '#28a745',
                                backgroundColor: 'rgba(40, 167, 69, 0.1)',
                                tension: 0.1,
                                fill: true
                            },
                            {
                                label: 'Total Benefits',
                                data: benefitData,
                                borderColor: '#007bff',
                                backgroundColor: 'rgba(0, 123, 255, 0.1)',
                                tension: 0.1,
                                fill: true
                            },
                            {
                                label: 'Total Costs',
                                data: costData,
                                borderColor: '#dc3545',
                                backgroundColor: 'rgba(220, 53, 69, 0.1)',
                                tension: 0.1,
                                fill: true
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Amount (€)'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                position: 'top'
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false
                            }
                        }
                    }
                });
            } else {
                roiChart.data.datasets[0].data = roiData;
                roiChart.data.datasets[1].data = benefitData;
                roiChart.data.datasets[2].data = costData;
                roiChart.update();
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listeners to all input fields
            const inputIds = [
                "numberOfUsers", "timeSaved", "valuePerHour", "queriesPerDay",
                "workingDays", "costPerQuery", "fixedCost", "buildDays",
                "costPerDay", "totalBuildCost", "buildCostToggle"
            ];

            inputIds.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', calculateROI);
                }
            });

            // Add build cost toggle handler
            document.getElementById("buildCostToggle").addEventListener('change', function() {
                document.getElementById("calculatedBuildCost").style.display = this.checked ? "flex" : "none";
                document.getElementById("customBuildCost").style.display = this.checked ? "none" : "flex";
                calculateROI();
            });

            // Initial calculation
            calculateROI();
        });
    </script>
</body>
</html>
